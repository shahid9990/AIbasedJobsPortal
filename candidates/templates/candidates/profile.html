{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h4>Candidate Profile</h4>
        </div>
        <div class="card-body">
            <form id="candidate-profile-form" method="POST">
    {% csrf_token %}
    
    <div class="form-floating mb-3">
        <input type="text" class="form-control" name="firstname" value="{{ candidate.firstname }}" required>
        <label>First Name</label>
    </div>

    <div class="form-floating mb-3">
        <input type="text" class="form-control" name="lastname" value="{{ candidate.lastname }}" required>
        <label>Last Name</label>
    </div>

    <div class="form-floating mb-3">
        <input type="text" class="form-control" name="phone" value="{{ candidate.phone }}">
        <label>Phone</label>
    </div>

    <button type="submit" class="btn btn-primary">Save</button>
	<a href="{% url 'candidate_dashboard' %}" class="btn btn-secondary">Cancel</a>
</form>
        </div>
    </div>
</div>
<script>
document.getElementById("candidate-profile-form").addEventListener("submit", function(event) {
    event.preventDefault();  //Prevent form from reloading the page

    let formData = new FormData(this);

    fetch("/candidates/profile/update/", {
        method: "POST",  //Ensure it sends a POST request
        body: formData,
        headers: { "X-CSRFToken": getCSRFToken() }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert("Profile updated successfully!");
        } else {
            alert("Error: " + data.error);
        }
    })
    .catch(error => console.error("Error updating profile:", error));
});

//Function to Get CSRF Token from Cookies
function getCSRFToken() {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
        let cookies = document.cookie.split(";");
        for (let i = 0; i < cookies.length; i++) {
            let cookie = cookies[i].trim();
            if (cookie.startsWith("csrftoken=")) {
                cookieValue = cookie.substring("csrftoken=".length, cookie.length);
                break;
            }
        }
    }
    return cookieValue;
}
</script>


{% endblock %}
