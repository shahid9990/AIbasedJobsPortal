{% extends 'base.html' %}

{% block content %}
<div class="card mt-4">
    <div class="card-header">Change Password</div>
    <div class="card-body">
        <form id="change-password-form">
            {% csrf_token %}
            <div class="form-floating mb-3">
                <input type="password" class="form-control" id="old-password" name="old_password" placeholder="Enter old password" required>
                <label for="old-password">Old Password</label>
            </div>
            <div class="form-floating mb-3">
                <input type="password" class="form-control" id="new-password" name="new_password" placeholder="Enter new password" required>
                <label for="new-password">New Password</label>
            </div>
            <div class="form-floating mb-3">
                <input type="password" class="form-control" id="confirm-password" name="confirm_password" placeholder="Confirm new password" required>
                <label for="confirm-password">Confirm New Password</label>
            </div>
            <button type="submit" class="btn btn-primary">Change Password</button>
			<a href="{% url 'candidate_dashboard' %}" class="btn btn-secondary">Cancel</a>
        </form>
        <div id="change-password-message" class="alert mt-3" style="display: none;"></div>
    </div>
</div>

<script>
document.getElementById("change-password-form").addEventListener("submit", function (event) {
    event.preventDefault();

    let formData = new FormData(this);
    fetch("/candidates/profile/change-password/", {
        method: "POST",
        headers: { "X-CSRFToken": getCSRFToken() },
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        let messageBox = document.getElementById("change-password-message");
        messageBox.style.display = "block";
        messageBox.className = data.success ? "alert alert-success" : "alert alert-danger";
        messageBox.textContent = data.success ? data.message : data.error;

        if (data.success) {
            document.getElementById("change-password-form").reset();  // Clear form on success
        }
    });
});


//Function to Get CSRF Token from Cookies
function getCSRFToken() {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
        let cookies = document.cookie.split(";");
        for (let i = 0; i < cookies.length; i++) {
            let cookie = cookies[i].trim();
            if (cookie.startsWith("csrftoken=")) {
                cookieValue = cookie.substring("csrftoken=".length, cookie.length);
                break;
            }
        }
    }
    return cookieValue;
}
</script>


{% endblock %}
